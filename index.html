<!DOCTYPE html>

<html xmlns=="gttp://www.w3.org/1999/xhtml" xml:lang="en" lang = "en">
<head>

	<!//Created by Reddit.com user DavidNatan
	// on 4/28/2013. This tool is currently
	// in BETA.>

	<meta http=equiv="Content-Type" content="text/html" charset="utf-8" />
	<title>Mass RES Tagger</title>
	
	<script src="http://yui.yahooapis.com/3.8.0/build/yui/yui-min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js">
	
	
	
	
	
	</script>
</head>
<body >
<center>

<div>
<input type="text" placeholder = "Subreddit Name Only" id="subreddit" />
<input type="text" placeholder = "Number of Pages"id="pagesNumber" />
<input type="text" placeholder = "TAG text" id="tag" />

<select id = "myList">

               <option value = "none" id = "colour" placeholder = "color">none</option>
               <option name = "c1" value = "aqua" style="background-color:aqua">aqua</option>
               <option name = "c1" value = "black" style="background-color:black; color:white">black</option>
               <option name = "c1" value = "blue" style="background-color:blue">blue</option>
			   <option name = "c1" value = "fuchsia" style="background-color:fuchsia">fuchsia</option>
			   <option name = "c1" value = "grey" style="background-color:grey">grey</option>
			   <option name = "c1" value = "green" style="background-color:green">green</option>
			   <option name = "c1" value = "lime" style="background-color:lime">lime</option>
			   <option name = "c1" value = "maroon" style="background-color:maroon">maroon</option>
			   <option name = "c1" value = "navy" style="background-color:navy">navy</option>
			   <option name = "c1" value = "olive" style="background-color:olive">olive</option>
			   <option name = "c1" value = "orange" style="background-color:orange">orange</option>
			   <option name = "c1" value = "purple" style="background-color:purple">purple</option>
			   <option name = "c1" value = "red" style="background-color:red">red</option>
			   <option name = "c1" value = "silver" style="background-color:silver">silver</option>
			   <option name = "c1" value = "teal" style="background-color:teal">teal</option>
			   <option name = "c1" value = "white" style="background-color:white">white</option>
			   <option name = "c1" value = "yellow" style="background-color:yellow">yellow</option>
</select>

<button id='gen_list'>Generate List</button>
</div>



<div id = "main">

<textarea id="status"  readonly="readonly" rows = "4" cols =  "60" style="background-image: url('statusBG.png'); background-repeat:no-repeat; color:white; background-color:#57737E"> ***STATUS*** </textarea>
<div>
<textarea placeholder = "Paste old TAGS here" id="oldTags" rows = "10" cols =  "60" style="background-image: url('oldTagsBG.png'); background-repeat:no-repeat"></textarea>
</div>
<div>
<textarea placeholder = "Results include your old TAGS" id="output" rows = "10" cols =  "60" style="background-image: url('newTagsBG.png'); background-repeat:no-repeat"></textarea>
</div>
<div>
<textarea readonly="readonly" id="instructions" rows = "10" cols =  "60">
***INSTRUCTIONS***
- Install RES: http://redditenhancementsuite.com/
- Go into a reddit tab and press the period on your keyboard
- Enter: RESStorage update RESmodules.userTagger.tags 
- Copy the whole text and paste it in the old TAGS field 
- Fill in the required fields above and press Generate List
- Wait for the Results to appear
- Paste the results back into the RES TAGS window
- Or paste them in the old Tags field and go again
</textarea>
</div>
<p> Created by Reddit.com user DavidNatan on 4/28/2013. This tool is currently in BETA.
<a href="http://www.reddit.com/r/masstagger/">For News and Updates: www.reddit.com/r/masstagger/</a></p>
</div>

</center>

<script src="http://yui.yahooapis.com/3.8.0/build/yui/yui-min.js"></script>

</body>

<script language="javascript">


    //get info about link
	
	//var query_string = {};
    //var query = window.location.search.substring(1);
    //var vars = query.split("&");
	//console.log(vars);
	// user u/o
	// user u
		// list of subreddits li = 
	// user o
		// subName subPages subTAG subColor
		
	//var user; 	
	//var host = false;
	//var listInterest;
	//var listData;
	//if(vars[0].split("=")[0]=="u"){user = vars[0].split("=")[1];console.log(user);}	
	//if(vars[1].split("=")[1]=="true"){host = vars[1].split("=")[1];console.log(host);}	
	//if(host){
	//listInterest = vars[2].split("$");
	//console.log(listInterest);
	//}
	//if(!host){
	//listData = vars[2].split("$");
	//console.log(listData);
	//}
	
	//apply data if any
	
	//if(listData.length>0){
	//		document.getElementById("subreddit").value = listData[0];
	//		document.getElementById("pagesNumber").value = listData[1];
	//		document.getElementById("tag").value = listData[2];			
	//		document.getElementById("colour").value = listData[3];
	//}
		
  
    //if a user followed someone elses link parse data into search query
	//if they followed their own link include field with their subreddits of interest
  
    var URL = "http://www.reddit.com/r/" + document.getElementById("subreddit").value + "/";
	var tagLetters = "";
	var tagColour = "none";
	
	var currentURL = URL;
	var yql_query;
	var links = new Array();
	var users = new Array();
	var usersOld = new Array();
	var phaseTwo = false;
	var countURL = 0;
	var pagesNum = 1;
	var statusText = "***STATUS***";
	var maxPages;
	var oldTagsText;
	var myURL = "http://dnatan.github.io/grandmaster/";
	var linkData = "/r/masstagger";
	//"link":"/r/talesfromtechsupport/comments/1d89ku/enter_mouse_button/",
	 

  YUI().use('node', 'event', 'yql', function(Y) {  
  
		Y.one("#gen_list").on('click',function() { 
		
		                URL = "http://www.reddit.com/r/" + document.getElementById("subreddit").value + "/";
		                currentURL = URL;
						phaseTwo = false;
						countURL = 0;
						links = new Array();
						users = new Array();
						statusText = "***STATUS***";
						oldTagsText = document.getElementById('oldTags').value;
						
						//console.log(oldTagsText);
						
						var splitOne = oldTagsText.split("\":{\"");
						for(var countTags = 0;countTags<splitOne.length;countTags++){
						    var tempUser = splitOne[countTags].split("\"")[splitOne[countTags].split("\"").length-1];
							usersOld.push(tempUser);
							//console.log(tempUser);
						}
						
			            pagesNum = document.getElementById("pagesNumber").value;
						tagLetters = document.getElementById("tag").value;
						
						var e = document.getElementsByName('c1');
                       
					    for(var c5 = 0;c5<e.length;c5++){
						if(e[c5].selected == true){tagColour = e[c5].value;}}
						
						
						//tagColour = document.getElementById("colour").options[document.getElementById("colour").selectedIndex].value;
						
						  
						yql_query = "select * from html where url='" + currentURL +"'";  
						yql_query += " and compat='html5' and compat='html5'";  
						
							var q = Y.YQL(yql_query, function(response) {  
							//var stories = "<textarea placeholder = \"Results\" id=\"output\" rows = \"10\" cols =  \"60\">";
							var stories = "<textarea placeholder = \"Results include your old TAGS\" id=\"output\" rows = \"10\" cols =  \"60\" style=\"background-image: url('newTagsBG.png'); background-repeat:no-repeat\">";
							  allowCache: false;
							  if(response.query.results){  
								  
								  if(!phaseTwo){
								  
								  var stringData = JSON.stringify(response.query.results);
								  var stringListEin = new Array();
								  URL = stringData.split("new/")[0].split("\"")[stringData.split("new/")[0].split("\"").length-1];
								  //console.log(URL);
								  
								  stringListEin = stringData.split(URL + "comments/");
								  var stringListZvei = new Array();
								  //console.log(stringData);
								  var pageNext = (stringData.split(",\"rel\":\"nofollow next\"")[0].split("\{\"href\":")[stringData.split(",\"rel\":\"nofollow next\"")[0].split("\{\"href\":").length-1]);
								  
								  statusText = statusText.concat("\n***Pulling threads from: \n" + currentURL + "***");
								  var textarea = document.getElementById('status');
                                  textarea.innerHTML = statusText;
								  document.getElementById("status").scrollTop =    document.getElementById("status").scrollHeight
								  
								  currentURL = pageNext.split("\"")[1];
								  
								  for(var count = 0;count<stringListEin.length;count++){
								  
								  stringListZvei.push( stringListEin[count].split("\",")[0]);
								  
								  }
								  
								  for(var i = 1;i<stringListZvei.length;i++){
								  
								  var hasIt = false;
								  
								  for(var j=0; j<links.length;j++){
								  
								  if(links[j] == (URL.concat("comments/" + stringListZvei[i]))){hasIt = true;break;}
								  
								  }
								  
								  if(!hasIt){links.push(URL.concat("comments/" + stringListZvei[i]))}
								  
								  }
                                  
								 //console.log("******************************************");
								 //console.log(currentURL + " " + yql_query);
								 //console.log("******************************************");
								 
								 
								 
							      yql_query = "select * from html where url='" + currentURL +"'";  
								  yql_query += " and compat='html5' and compat='html5'";  
								  q._params.q = yql_query;
								  
								  
								  
								  //console.log(q._params.q);
								  
								  if(pagesNum>1){pagesNum--;}else{phaseTwo = true;
								  maxPages = links.length;
								  for(var j2=0; j2<links.length;j2++){
								  
								 
								  //console.log(j2 + " " + links[j2]);
								  //stories+= j2 + " " + links[j2] + "<br />";
								  
								  }
								  
								  }
								 
							  } 
							  
							  if(phaseTwo){
							   //console.log(links.length);
							  if(countURL<links.length){
							      yql_query = "select * from html where url='" + links[countURL] +"'";  
								  yql_query += " and compat='html5' and compat='html5'";  
								  q._params.q = yql_query;
								  
								  //console.log(countURL + " " + yql_query);
								  
								 statusText = statusText.concat("\n***Getting users from thread : " + (countURL+1) + " of " + maxPages + "***");
								 var textarea = document.getElementById('status');
                                 textarea.innerHTML = statusText;
								 document.getElementById("status").scrollTop =    document.getElementById("status").scrollHeight
								 
							      countURL++; 
								  
								  var stringData2 = JSON.stringify(response.query.results);
								  var stringListEin2 = new Array();
								  stringListEin2 = stringData2.split("/user/");
								  var stringListZvei2 = new Array();
								  
								  for(var count = 0;count<stringListEin2.length;count++){
								  
											  var hasIt = false;
											  
													   for(var count2 = 0;count2<users.length;count2++){
													  
														 if(users[count2] == (stringListEin2[count].split("\"")[0])){
														  hasIt = true;break;
													  
														 }
													  
													   }
													   
													   for(var count3 = 0;count3<usersOld.length;count3++){
													  
														 if(usersOld[count3] == (stringListEin2[count].split("\"")[0])){
														  hasIt = true;break;
													  
														 }
													  
													   }
											  
												   if(!hasIt){
												   users.push(stringListEin2[count].split("\"")[0]);
												   //console.log(users[users.length-1]);
												   }
								   }
								  
							  }else{
							   
							  //console.log(users);
							  
							 
							  
							  var suffix = "\":{\"tag\":\"" + tagLetters + "\", \"link\":\"" + linkData + "\",\"color\":\""
								+ tagColour + "\"}";
							  var prefix = "\"";
							  
							  if(oldTagsText.length>0){
							  stories += oldTagsText.substring(0, oldTagsText.length - 1) + ",";
							  }else{
							  stories+="{";
							  }
							  for(var count3 = 0;count3<users.length;count3++){
							  
							  stories+= prefix + users[count3] + suffix + " ";
							  
							  if(count3<users.length-1){stories+=",";}
							  
							  }
							  
							  stories +="}";
							  
							  stories += "</textarea>";  
							  Y.one('#output').replace(stories);  
							  stories = "";  
							  
							  handel.cancel();
							  
							  }
							  
							  
							  
							  
							  }
							  
							  }
							}); 
							
						      
							
							 
							var handel = Y.later(2000, q, q.send, null, true);
							 
							 
							 
							 
							
							
							
							
					
				
				
			
		});   
	
	
	
  });         

</script>




</html>


